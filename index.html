<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consultoría Reforma Laboral 2025</title>
  <style>
    /* Estilos base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      /* Usando Inter como se recomienda */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #1a237e;
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      color: #5e35b1;
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      border-color: #667eea;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #1a237e;
      font-weight: 600;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Estilos para la nueva pantalla de secciones */
    .sections-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .sections-list p {
      background: #f8f9ff;
      border: 1px solid #e0e0e0;
      padding: 15px;
      border-radius: 8px;
      color: #333;
      font-size: 1.1em;
      font-weight: 500;
      text-align: left;
      transition: all 0.3s ease;
    }

    .sections-list p:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
    }

    /* Estilos para el título de la norma y sección en la pantalla de preguntas */
    .section-and-norm-title {
      background: #f8f9ff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
    }

    .question-container {
      margin-bottom: 30px;
    }

    .question-title {
      font-size: 1.3em;
      color: #1a237e;
      margin-bottom: 20px;
      font-weight: 600;
      line-height: 1.4;
    }

    .options-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .option-btn {
      padding: 12px 25px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .option-btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .option-btn.selected {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .recommendation {
      background: #f8f9ff;
      border-left: 4px solid #667eea;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      line-height: 1.6;
    }

    .recommendation h4 {
      color: #1a237e;
      margin-bottom: 10px;
    }

    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .progress-bar {
      width: 100%;
      height: 5px;
      /* Reduced height for a thinner bar */
      background: #e0e0e0;
      border-radius: 4px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s ease;
    }

    .hidden {
      display: none;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    /* Estilos para la pantalla de completado */
    #completion-screen {
      text-align: center;
      padding: 40px;
    }

    #completion-screen h2 {
      font-size: 2em;
      margin-bottom: 15px;
    }

    #completion-screen p {
      font-size: 1.1em;
      line-height: 1.6;
    }


    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .header h1 {
        font-size: 2em;
      }

      .section-buttons {
        /* This rule is now deprecated for sections-overview-screen */
        grid-template-columns: 1fr;
      }

      .options-container {
        flex-direction: column;
      }

      .navigation {
        flex-direction: column;
        gap: 10px;
      }

      .sections-list {
        gap: 8px;
      }

      .sections-list p {
        padding: 12px;
        font-size: 1em;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Reforma Laboral 2025</h1>
      <p>Ley 2466 de 2025 - Consultoría Jurídica Especializada</p>
    </div>

    <div id="initial-screen" class="card">
      <h2 style="color: #1a237e; margin-bottom: 20px; text-align: center;"> ¿Ya sabes cómo afecta a tu empresa la nueva
        Reforma Laboral (Ley 2466 de 2025)? </h2>
      <p style="text-align: center; margin-bottom: 30px; color: #666; font-size: 1.1em;"> Consulta gratis aquí y
        descubre los ajustes necesarios para tu empresa </p>
      <form id="user-form">
        <div class="form-group">
          <label for="empresa_inicial">Empresa *</label>
          <input type="text" id="empresa_inicial" name="empresa_inicial" required>
        </div>
        <div class="form-group">
          <label for="nombre">Nombre Completo *</label>
          <input type="text" id="nombre" name="nombre" required>
        </div>
        <div class="form-group">
          <label for="telefono">Teléfono *</label>
          <input type="tel" id="telefono" name="telefono" required>
        </div>
        <div class="form-group">
          <label for="email">Correo Electrónico *</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div style="text-align: center;">
          <button type="submit" class="btn">Consultar</button>
        </div>
      </form>
    </div>

    <div id="sections-overview-screen" class="card hidden">
      <h2 style="color: #1a237e; margin-bottom: 20px; text-align: center;"> Autodiagnóstico de la Reforma Laboral 2025
      </h2>
      <p style="text-align: center; margin-bottom: 30px; color: #666;">
        Te guiaremos a través de las secciones clave de la nueva Ley 2466 de 2025.
        Al finalizar, recibirás recomendaciones personalizadas para tu empresa.
      </p>
      <div id="sections-list" class="sections-list">
        <!-- Los títulos de las secciones se insertarán aquí dinámicamente -->
      </div>
      <div style="text-align: center; margin-top: 30px;">
        <button id="start-autodiagnosis-btn" class="btn">Iniciar mi autodiagnóstico</button>
        <button id="back-to-initial-btn" class="btn btn-secondary" style="margin-left: 10px;">Volver</button>
      </div>
    </div>

    <!-- Nueva pantalla intersticial entre secciones -->
    <div id="interstitial-screen" class="card hidden">
      <h2 id="interstitial-main-title" style="color: #1a237e; margin-bottom: 20px; text-align: center;"></h2>
      <p id="interstitial-description" style="text-align: center; margin-bottom: 30px; color: #666;"></p>
      <h3 id="next-section-title" style="color: #5e35b1; font-size: 1.8em; text-align: center; margin-bottom: 40px;">
      </h3>
      <div style="text-align: center;">
        <button id="continue-to-next-section-btn" class="btn">Continuar</button>
      </div>
    </div>

    <div id="questions-screen" class="card hidden">
      <div class="section-and-norm-title">
        <h2 id="norm-title" style="color: #5e35b1; font-size: 1.5em; margin-bottom: 5px;">Reforma Laboral 2025</h2>
        <h3 id="current-section-title" style="color: #1a237e; font-size: 1.2em;"></h3>
      </div>
      <div class="progress-bar">
        <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
      </div>
      <div class="question-container">
        <h3 id="question-text" class="question-title"></h3>
        <div id="options-container" class="options-container">
        </div>
        <div id="recommendation" class="recommendation hidden">
          <h4>Recomendación:</h4>
          <p id="recommendation-text"></p>
        </div>
      </div>
      <div class="navigation">
        <button id="back-btn" class="btn btn-secondary" onclick="previousQuestion()">Volver</button>
        <button id="next-btn" class="btn" onclick="nextQuestion()">Siguiente</button>
      </div>
    </div>

    <!-- Nueva pantalla para el formulario de contacto -->
    <div id="contact-form-screen" class="card hidden">
      <h2 style="color: #1a237e; margin-bottom: 20px; text-align: center;">Confirmación de Datos</h2>
      <p style="text-align: center; margin-bottom: 30px; color: #666;">
        Por favor, completa los siguientes datos para que podamos contactarte.
      </p>
      <form id="contact-form">
        <div class="form-group">
          <label for="empresa">Empresa *</label>
          <input type="text" id="empresa" name="empresa" required>
        </div>
        <div class="form-group">
          <label for="telefono_contacto">Teléfono *</label>
          <input type="tel" id="telefono_contacto" name="telefono_contacto" required>
        </div>
        <div class="form-group">
          <label for="email_contacto">Correo Electrónico *</label>
          <input type="email" id="email_contacto" name="email_contacto" required>
        </div>
        <div style="text-align: center;">
          <button type="submit" class="btn">Enviar Datos</button>
        </div>
      </form>
    </div>

    <div id="completion-screen" class="card hidden">
      <h2 style="color: #1a237e; margin-bottom: 20px; text-align: center;">¡Autodiagnóstico Completado!</h2>
      <!-- Se ha eliminado el texto pequeño aquí -->
      <div style="text-align: center;">
        <button class="btn" onclick="showInitialScreen()">Volver al Inicio</button>
      </div>
    </div>

  </div>

  <script>
    let currentSectionIndex = 0;
    let currentQuestionIndex = 0;
    let history = []; // Para almacenar el historial de preguntas y respuestas
    let selectedAnswer = null;
    let companyClassification = null; // Para almacenar la clasificación de la empresa en Sección 3

    const initialScreen = document.getElementById('initial-screen');
    const sectionsOverviewScreen = document.getElementById('sections-overview-screen'); // Renombrado
    const sectionsList = document.getElementById('sections-list'); // Nuevo elemento para la lista de secciones
    const startAutodiagnosisBtn = document.getElementById('start-autodiagnosis-btn'); // Nuevo botón
    const backToInitialBtn = document.getElementById('back-to-initial-btn'); // Botón para volver desde el overview de secciones
    const interstitialScreen = document.getElementById('interstitial-screen'); // Nueva pantalla intersticial
    const interstitialMainTitle = document.getElementById('interstitial-main-title'); // Título principal de la intersticial
    const interstitialDescription = document.getElementById('interstitial-description'); // Descripción de la intersticial
    const nextSectionTitleElement = document.getElementById('next-section-title'); // Título de la próxima sección en la pantalla intersticial
    const continueToNextSectionBtn = document.getElementById('continue-to-next-section-btn'); // Botón para continuar desde la pantalla intersticial
    const questionsScreen = document.getElementById('questions-screen');
    const userForm = document.getElementById('user-form');
    const questionTextElement = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const recommendationDiv = document.getElementById('recommendation');
    const recommendationTextElement = document.getElementById('recommendation-text');
    const backBtn = document.getElementById('back-btn');
    const nextBtn = document.getElementById('next-btn');
    const progressBarFill = document.getElementById('progress-fill');
    const currentSectionTitleElement = document.getElementById('current-section-title'); // Nuevo elemento para el título de la sección
    const contactFormScreen = document.getElementById('contact-form-screen'); // Nueva pantalla de formulario de contacto
    const contactForm = document.getElementById('contact-form'); // Formulario de contacto
    const completionScreen = document.getElementById('completion-screen'); // Nueva pantalla de completado

    // Definición de los umbrales de ingresos por sector
    const incomeThresholds = {
      "industrial": [
        { text: "Menor o igual a $1.173 millones", value: "industrial_micro", classification: "Microempresa" },
        { text: "Mayor a $1.173 millones y hasta $10.212 millones", value: "industrial_pequena", classification: "Pequeña" },
        { text: "Mayor a $10.212 millones y hasta $86.517 millones", value: "industrial_mediana", classification: "Mediana" },
        { text: "Mayor a $86.517 millones", value: "industrial_gran", classification: "Gran" }
      ],
      "servicios": [
        { text: "Menor o igual a $1.642 millones", value: "servicios_micro", classification: "Microempresa" },
        { text: "Entre $1.642 y $6.575 millones", value: "servicios_pequena", classification: "Pequeña" },
        { text: "Entre $6.575 y $24.060 millones", value: "servicios_mediana", classification: "Mediana" },
        { text: "Mayor a $24.060 millones", value: "servicios_gran", classification: "Gran" }
      ],
      "comercio": [
        { text: "Menor o igual a $2.229 millones", value: "comercio_micro", classification: "Microempresa" },
        { text: "Entre $2.229 y $21.480 millones", value: "comercio_pequena", classification: "Pequeña" },
        { text: "Entre $21.480 y $107.566 millones", value: "comercio_mediana", classification: "Mediana" },
        { text: "Mayor a $107.566 millones", value: "comercio_gran", classification: "Gran" }
      ]
    };

    // Datos de las secciones y preguntas extraídos del DOCX
    const sectionsData = [
      // SECCIÓN 1: CONTRATACIÓN LABORAL
      {
        title: "Contratación Laboral",
        questions: [
          {
            text: "¿Todos los contratos laborales en tu empresa están formalizados por escrito y firmados por ambas partes?",
            type: "yes_no",
            recommendations: {
              "Sí": `Con la entrada en vigor de la Ley 2466 de 2025, es necesario actualizar la minuta del contrato laboral para alinearla con los nuevos requerimientos legales. Es fundamental revisar si hubo cambios en la jornada inicialmente pactada, y definir claramente cuál será el día de descanso obligatorio del trabajador.
Además, se deben establecer las obligaciones del empleador y las reglas de conducta que el trabajador debe acatar para contribuir a un entorno laboral libre de discriminación, acoso y violencia.
También es recomendable incluir cláusulas que delimiten los requisitos formales de solicitud y justificación de los nuevos permisos laborales, tales como: Asistencia a citas médicas con especialistas, asistir a las obligaciones escolares como acudiente y concurrir a citaciones judiciales, con el fin de evitar su uso abusivo o indebido. Finalmente, se debe considerarse la posibilidad de acordar el pago mensualizado de las cesantías y sus intereses, conforme a lo permitido por la nueva ley.`,
              "No": `Formaliza por escrito todos los contratos laborales sin excepción. La ley presume contrato a término indefinido si no hay documento firmado.
Recomendaciones clave:
1. Redacta y firma contratos con cada trabajador.
2. Define tipo de contrato, duración y jornada.
3. Pacta por escrito el día de descanso obligatorio.
4. Establece las obligaciones del empleador y las reglas de conducta que el trabajador debe acatar para contribuir a un entorno laboral libre de discriminación, acoso y violencia.
5. Incluye cláusulas que delimiten los requisitos formal es de solicitud y justificación de los nuevos permisos laborales, tales como: asistencia a citas médicas con especialistas, asistir a las obligaciones escolares como acudiente y concurrir a citaciones judiciales, con el fin de evitar su uso abusivo o indebido.
6. Considera la posibilidad de acordar el pago mensualizado de las cesantías y sus intereses, conforme a lo permitido por la ley.
7. Entrega copia firmada y guarda soporte.`
            }
          },
          {
            text: "¿Tu empresa tiene actualmente trabajadores contratados a término fijo?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Puedes mantener la vinculación a plazo fijo por cuatro (4) años más, hasta 25 de junio de 2029, de esa fecha en adelante inmediatamente se convierte en indefinido.
2. Verifica que todos los contratos estén por escrito y con indicación clara de la fecha de inicio y fin.
3. Controla las fechas para evitar prórrogas automáticas no deseadas, en adelante preferiblemente realiza las prórrogas por escrito.
4. Verifica cuántas prórrogas han tenido los contratos hasta la fecha, evalúa cuáles cargos requieren continuidad y la posibilidad de replantear su modelo a contratos indefinidos lo cual puedes hacer mediante otrosí.
5. Reevalúa qué cargos requieren realmente una vinculación temporal.`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Los contratos a término fijo indican de forma clara la duración exacta del vínculo laboral?",
            type: "yes_no",
            recommendations: {
              "Sí": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`,
              "No": `
Ajusta todos los contratos vigentes para incluir una duración específica y clara. La ambigüedad da lugar a que el contrato se interprete como a término indefinido.`
            }
          },
          {
            text: "¿Los contratos a término fijo tienen una duración inicial inferior a 12 meses?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Considera realizar todas las prórrogas de manera formal y por escrito.
2. Recuerda que en adelante desde la cuarta prórroga en adelante la duración no puede ser inferior a 1 año.
3. Implementa un sistema de control que te alerte sobre la cantidad y duración de las prórrogas firmadas.
4. Evalúa la viabilidad de contratar directamente a término indefinido cuando no este justificada la duración temporal del contrato.`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Contratas empleados por obra o labor determinada?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Verifica que la obra o labor esté claramente definida en el contrato, y que exista un vínculo evidente entre el objeto del contrato y una actividad clara, temporal y delimitada.
2. Evita el uso del contrato por obra o labor para tareas permanentes o estructurales del negocio. Esto puede considerarse fraude laboral y conlleva la conversión del contrato a término indefinido.
3. Fortalece tus procesos de control y seguimiento del objeto contratado, ya que ahora se exige mayor carga administrativa para justificar este tipo de vinculación.
4. Revisa si el personal que actualmente tienes contratado bajo esta modalidad debe ser migrado a contratos a término indefinido, especialmente si desempeñan funciones misionales o de duración permanente.
5. Revisa y documenta claramente la finalización de las actividades pactadas. Es fundamental dejar trazabilidad sobre el cierre de la obra o labor.
6. Si requieres que el trabajador continúe con nuevas labores asociadas a otra obra o necesidad puntual, suscribe por escrito un nuevo contrato o amplía el anterior mediante otrosí especificando el nuevo objeto y duración.`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          }
        ]
      },
      // SECCIÓN 2: CONTRATO DE APRENDIZAJE
      {
        title: "Contrato de Aprendizaje",
        questions: [
          {
            text: "¿Tu empresa tiene más de 15 trabajadores?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Verifica que estás cumpliendo con la cuota mínima obligatoria conforme al número de trabajadores.
2. Evalúa si te resulta más conveniente monetizar la cuota o vincular directamente al aprendiz, teniendo en cuenta el impacto económico y operativo.
3. Asegúrate de formalizar correctamente el contrato de aprendizaje bajo los nuevos parámetros, según el cual ahora se considera como Contrato a término fijo especial.
4. Mantén registros actualizados y certificados del tiempo en práctica, ya que ahora se reconoce como experiencia laboral.
5. Evalúa la viabilidad de implementar la modalidad de formación dual, que integra teoría y práctica de manera simultánea con acompañamiento conjunto entre la empresa y el Sena. Esta modalidad te ayuda a formar nuevos talentos alineado a las necesidades reales del negocio, ya que la empresa participa activamente en el diseño del plan formativo del aprendiz.`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tu empresa tiene o planea contratar trabajadores extranjeros?",
            type: "yes_no",
            recommendations: {
              "Sí": `Debes tener en cuenta los cambios introducidos por la reforma laboral respecto a trabajadores migrantes:
Recomendaciones clave:
1. Garantiza igualdad de derechos laborales y de seguridad social a las personas extranjeras, sin importar su estatus migratorio.
2. Ya no necesitas una visa de trabajo previa, por lo cual una vez se haya suscrito el contrato de trabajo, ponte en contacto con Migración Colombia quien debe facilitar el proceso de regularización migratoria.
3. Mantente atento a la reglamentación que expedirá el Ministerio de Relaciones Exteriores sobre el proceso de regularización.
4. Cumple con las obligaciones de reporte vigentes:
4.1 Notificar a Migración Colombia el inicio, terminación o cualquier novedad del contrato laboral con extranjeros, a través de la plataforma SIRE.
4.2 Reportar ante el Ministerio del Trabajo el inicio y terminación del contrato a través del RUTEC.
5. Evalúa la posibilidad de aplicar el teletrabajo transnacional, si la naturaleza del cargo permite desarrollar el trabajo a distancia.`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          }
        ]
      },
      // SECCIÓN 3: PROCESOS DISCIPLINARIOS Y RIT
      {
        title: "Procesos Disciplinarios y RIT",
        questions: [
          {
            text: "¿A qué sector pertenece tu empresa?",
            type: "multiple_choice",
            options: [
              { text: "Sector manufacturero, agropecuario o industrial", value: "industrial" },
              { text: "Sector servicios", value: "servicios" },
              { text: "Sector de comercio", value: "comercio" }
            ]
          },
          {
            text: "¿Cuál es el nivel anual de ingresos ordinarios de tu empresa?",
            type: "conditional_income", // This question type will trigger custom logic
            recommendations: {
              // Estas recomendaciones son genéricas para la pregunta de ingresos
              // La recomendación final para Micro/Pequeña se define después de la pregunta de empleados
              "continue_to_next": `Por favor, continúa a la siguiente pregunta para una recomendación más precisa.`,
              "Microempresa_Menos10": `Las micro y pequeñas empresas con menos de diez (10) trabajadores no están obligadas a tener un Reglamento Interno de Trabajo (RIT), salvo que pertenezcan al sector comercio o superen ese número de trabajadores.
Tampoco deben implementar un procedimiento disciplinario formal, pero sí deben garantizar un proceso básico de debido proceso antes de imponer sanciones, lo cual implica ofrecer al trabajador la oportunidad de ser escuchado, documentar los hechos y la decisión adoptada, actuar con proporcionalidad y evitar decisiones arbitrarias.
Se recomienda tener una guía interna sencilla que oriente la actuación frente a faltas, capacitar al personal encargado sobre cómo manejar estas situaciones, y siempre dejar evidencia escrita de las actuaciones, lo cual brinda respaldo jurídico y evita conflictos futuros.`,
              "Microempresa_Mas10": `Tu empresa está obligada a contar con un Reglamento Interno de Trabajo (RIT). Donde obligatoriamente debes implementar un procedimiento formal para la imposición de sanciones disciplinarias, lo que incluye definir etapas claras de notificación, descargos, análisis y decisión.
Este proceso debe estar contenido en el RIT y alinearse con el principio de debido proceso, garantizando al trabajador el derecho a ser escuchado y a controvertir las acusaciones.
Se recomienda revisar o actualizar el RIT conforme a la reforma laboral vigente en un plazo no mayor a 12 meses, capacitar a los líderes sobre su aplicación, y asegurar la trazabilidad en cada actuación disciplinaria.
Reglamenta el uso de las TIC´S para llevar a cabo los procesos disciplinarios en tu empresa.`,
              "Pequeña_Menos10": `Las micro y pequeñas empresas con menos de diez (10) trabajadores no están obligadas a tener un Reglamento Interno de Trabajo (RIT), salvo que pertenezcan al sector comercio o superen ese número de trabajadores.
Tampoco deben implementar un procedimiento disciplinario formal, pero sí deben garantizar un proceso básico de debido proceso antes de imponer sanciones, lo cual implica ofrecer al trabajador la oportunidad de ser escuchado, documentar los hechos y la decisión adoptada, actuar con proporcionalidad y evitar decisiones arbitrarias.
Se recomienda tener una guía interna sencilla que oriente la actuación frente a faltas, capacitar al personal encargado sobre cómo manejar estas situaciones, y siempre dejar evidencia escrita de las actuaciones, lo cual brinda respaldo jurídico y evita conflictos futuros.`,
              "Pequeña_Mas10": `Tu empresa está obligada a contar con un Reglamento Interno de Trabajo (RIT). Donde obligatoriamente debes implementar un procedimiento formal para la imposición de sanciones disciplinarias, lo que incluye definir etapas claras de notificación, descargos, análisis y decisión.
Este proceso debe estar contenido en el RIT y alinearse con el principio de debido proceso, garantizando al trabajador el derecho a ser escuchado y a controvertir las acusaciones.
Se recomienda revisar o actualizar el RIT conforme a la reforma laboral vigente en un plazo no mayor a 12 meses, capacitar a los líderes sobre su aplicación, y asegurar la trazabilidad en cada actuación disciplinaria.
Reglamenta el uso de las TIC´S para llevar a cabo los procesos disciplinarios en tu empresa.`,
              "Mediana": `Tu empresa está obligada a contar con un Reglamento Interno de Trabajo (RIT). Donde obligatoriamente debes implementar un procedimiento formal para la imposición de sanciones disciplinarias, lo que incluye definir etapas claras de notificación, descargos, análisis y decisión.
Este proceso debe estar contenido en el RIT y alinearse con el principio de debido proceso, garantizando al trabajador el derecho a ser escuchado y a controvertir las acusaciones.
Se recomienda revisar o actualizar el RIT conforme a la reforma laboral vigente en un plazo no mayor a 12 meses, capacitar a los líderes sobre su aplicación, y asegurar la trazabilidad en cada actuación disciplinaria.
Reglamenta el uso de las TIC´S para llevar a cabo los procesos disciplinarios en tu empresa.`,
              "Gran": `Tu empresa está obligada a contar con un Reglamento Interno de Trabajo (RIT). Donde obligatoriamente debes implementar un procedimiento formal para la imposición de sanciones disciplinarias, lo que incluye definir etapas claras de notificación, descargos, análisis y decisión.
Este proceso debe estar contenido en el RIT y alinearse con el principio de debido proceso, garantizando al trabajador el derecho a ser escuchado y a controvertir las acusaciones.
Se recomienda revisar o actualizar el RIT conforme a la reforma laboral vigente en un plazo no mayor a 12 meses, capacitar a los líderes sobre su aplicación, y asegurar la trazabilidad en cada actuación disciplinaria.
Reglamenta el uso de las TIC´S para llevar a cabo los procesos disciplinarios en tu empresa.`
            }
          },
          {
            text: "¿Tienes menos de 10 trabajadores?", // This question will only be shown conditionally
            type: "yes_no_conditional",
            recommendations: {
              "Sí": `Las micro y pequeñas empresas con menos de diez (10) trabajadores no están obligadas a tener un Reglamento Interno de Trabajo (RIT), salvo que pertenezcan al sector comercio o superen ese número de trabajadores. Tampoco deben implementar un procedimiento disciplinario formal, pero sí deben garantizar un proceso básico de debido proceso antes de imponer sanciones, lo cual implica ofrecer al trabajador la oportunidad de ser escuchado, documentar los hechos y la decisión adoptada, actuar con proporcionalidad y evitar decisiones arbitrarias.
Se recomienda tener una guía interna sencilla que oriente la actuación frente a faltas, capacitar al personal encargado sobre cómo manejar estas situaciones, y siempre dejar evidencia escrita de las actuaciones, lo cual brinda respaldo jurídico y evita conflictos futuros.`,
              "No": `Tu empresa está obligada a contar con un Reglamento Interno de Trabajo (RIT).Donde obligatoriamente debes implementar un procedimiento formal para la imposición de sanciones disciplinarias, lo que incluye definir etapas claras de notificación, descargos, análisis y decisión.
Este proceso debe estar contenido en el RIT y alinearse con el principio de debido proceso, garantizando al trabajador el derecho a ser escuchado y a controvertir las acusaciones.
Se recomienda revisar o actualizar el RIT conforme a la reforma laboral vigente en un plazo no mayor a 12 meses, capacitar a los líderes sobre su aplicación, y asegurar la trazabilidad en cada actuación disciplinaria.
Reglamenta el uso de las TIC´S para llevar a cabo los procesos disciplinarios en tu empresa.`
            }
          },
          {
            text: "¿Tu empresa cuenta con un Reglamento Interno de Trabajo vigente y conocido por los trabajadores?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Asegúrate de actualizar el RIT conforme a las nuevas exigencias de la reforma laboral, en especial lo relacionado con el respeto a la dignidad humana, la no discriminación, los nuevos permisos remunerados, el día de descanso obligatorio, los requisitos para flexibilizar la jornada laboral a los trabajadores con responsabilidades del cuidado, las nuevas formas de trabajo a distancia. 
2. Publica el RIT en medios digitales accesibles que sean del control de la empresa. 
3. Asegúrate de diseñar un RIT adecuado para entornos digitales con el fin de facilitar su comprensión.`,
              "No": `
1. Si tienes más de 10 empleados el RIT es obligatorio. Inicia el diseño del reglamento a la mayor brevedad posible. 
2. Publica el RIT en medios digitales accesibles que sean del control de la empresa. 
3. Asegúrate de diseñar un RIT adecuado para entornos digitales con el fin de facilitar su comprensión.`
            }
          },
          {
            text: "¿La empresa tiene políticas definidas para prevenir y sancionar el acoso y la violencia en el trabajo?",
            type: "yes_no",
            recommendations: {
              "Sí": `Actualiza tus políticas para incorporar la ampliación del concepto de acoso y violencia en el trabajo de acuerdo con los parámetros nuevos que trae la reforma laboral.`,
              "No": `Es obligatorio para todas las empresas contar con mecanismos de prevención del acoso laboral y acoso sexual en el trabajo. Implementa un comité de convivencia actualizado conforme a la Ley 1010 y la nueva reforma laboral. Integra perspectiva de género y canales confidenciales.`
            }
          }
        ]
      },
      // SECCIÓN 4: JORNADAS Y RECARGOS
      {
        title: "Jornadas y Recargos",
        questions: [
          {
            text: "¿Tienes trabajadores que laboran después de las 7:00 p.m.?",
            type: "yes_no",
            recommendations: {
              "Sí": `
El recargo nocturno se mantiene en el 35% por hora labor, pero  desde el  25 de Diciembre de 2025, se aplicará desde las 7:00 p.m. hasta las 6:00 a.m., por lo cual debes implementar las siguientes acciones: 
1. Actualizar sistemas de nómina para que se liquide el  recargo nocturno desde la hora correcta.
2. Evaluar el impacto económico: Proyectar el aumento en los costos laborales y considerar posibles medidas de eficiencia operativa o redistribución de turnos.
3. Capacitar al personal de talento humano y supervisores: Para asegurar que comprendan el nuevo esquema, puedan hacer seguimiento adecuado.
4. Mantener registros claros de las jornadas y recargos pagados, ya que el Ministerio del Trabajo puede exigir soportes y aplicar sanciones en caso de incumplimiento.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tienes personal que labora domingos o festivos de manera ocasional o permanente?",
            type: "yes_no",
            recommendations: {
              "Sí": `
El tratamiento de estos días se ha unificado bajo el concepto de “día de descanso obligatorio”, y el recargo por trabajar en ellos se ajusta al 100% de manera progresiva:
A partir del 1° de julio de 2025, subirá al 80%;
desde el 1° de julio de 2026, será del 90%, 
a partir del 1° de julio de 2027 será del 100%, 
Aunque los empleadores pueden acogerse a este último desde ya si así lo deciden.
1. Evalúa el impacto financiero de este incremento en tu nomina
2. Evalúa la pertinencia de pactar (por escrito) que el día de descanso obligatorio sea distinto al domingo. 
3. Capacitar a RRHH y supervisores para que puedan realizar un adecuado control a la rotación de los turno laborales, a fin de evitar conflictos legales.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tu empresa opera en jornadas continuas o turnos rotativos (24/7), incluyendo trabajo nocturno o fines de semana?",
            type: "yes_no",
            recommendations: {
              "Sí": `
Debes prepararte para los impactos en costos laborales, asociados a: Reducción de la jornada laboral, aumento de recargos nocturnos, y aumento por trabajo en días de descanso obligatorio (antes domingos y festivos).
Realiza una valoración financiera que permita medir el impacto y te ayude a tomar decisiones estratégicas, que pueden incluir la implementación de la jornada especial de turnos continuos de  6 horas diarias / 36 horas semanales, permitiendo operar la empresa 24/7 reduciendo el impacto económico de recargos nocturnos, o por trabajo en domingos o festivos.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tu empresa tiene trabajadores que laboran tiempo suplementario (horas extras)?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Revisa si llevas un registro actualizado por trabajador y por tipo de hora (diurna/nocturna). Este registro debe incluir mínimo: Nombre, actividad desarrollada, número de horas y si son diurnas o nocturna. 
2. Asegúrate de que el registro se mantenga actualizado, sea auditable y se entregue al trabajador si lo solicita, con comprobante de pago.
3. Implementa inmediatamente un sistema confiable para controlar el número de horas extras que laboran tus empleados. 
4. Realiza una auditoría interna urgente y asegúrate que tus empleados no laboren mas de 2 horas extras día y 12 a la semana.
5. Verifica que las horas extras estén correctamente liquidadas y pagadas con sus recargos. Soporta estos pagos en la nómina y entrega comprobantes al trabajador. Un error de cálculo puede llevar a la suspensión de la facultad para trabajar horas extra por 6 meses y otras sanciones.
6. Recuerda, ya no necesitas autorización previa para que tus empleados laboren hora extra.
`,
              "No": `
En tu caso no se requieren ajustes adicionales derivados de la nueva norma. `
            }
          }
        ]
      },
      // SECCIÓN 5: INCLUSIÓN Y DIVERSIDAD
      {
        title: "Inclusión y Diversidad",
        questions: [
          {
            text: "¿Tu empresa cuenta con 100 o más trabajadores permanentes?",
            type: "yes_no",
            recommendations: {
              "Sí": `
Evalúa cuántos trabajadores con discapacidad tienes vinculados y verifica si cumples con este mínimo obligatorio:
• Hasta 500 empleados: al menos 2 trabajadores con discapacidad por cada 100 trabajadores.
• Más de 500 empleados: los anteriores más 1 adicional por cada tramo de 100 trabajadores.
Al momento de la vinculación asegura que los trabajadores con discapacidad cuenten con la certificación válida del Ministerio de Salud.
Si existen razones técnicas o de salud ocupacional que impidan la contratación de personas en situación de discapacidad para determinados cargos documéntalo adecuadamente para que puedas informarlo al Ministerio del Trabajo.
A partir del segundo año de entrada en vigencia de la reforma (julio de 2026), el cumplimiento de las cuotas de vinculación de personas con discapacidad será obligatorio. Por ello, es fundamental analizar desde ahora tu planta de cargos, identificar puestos viables para esta población, y planear con tiempo los ajustes razonables que permitan su contratación efectiva.
Capacita al equipo de Recursos Humanos sobre las obligaciones de registro obligatorio de contratos en la plataforma del Ministerio del Trabajo, y sensibiliza a los líderes y supervisores sobre discapacidad e inclusión laboral, para que estén preparados para gestionar estos procesos de forma adecuada.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tienes en tu empresa trabajadores(as) que ejercen responsabilidades de cuidado sobre hijos menores, personas con discapacidad, mayores o con enfermedades graves dentro de su núcleo familiar?",
            type: "yes_no",
            recommendations: {
              "Sí": `
Debes estar preparado para recibir solicitudes de flexibilidad laboral conforme a la nueva regulación. Asegúrate de:
1. Establecer un protocolo claro para evaluar solicitudes de flexibilización de la jornada laboral o implementación de teletrabajo.
2. Cuando la recibas documenta adecuadamente la solicitud, la evaluación y la respuesta que se dé, la cual debe entregarse en un plazo máximo de 15 días hábiles.
3. Incorporar como se regulará el ejercicio de este derecho en tu Reglamento Interno de Trabajo y contrato laboral.
`,
              "No": `Aunque hoy no tengas casos identificados, es recomendable:
1. Incluir este tema en el diagnóstico de clima laboral o encuestas internas, para anticiparte.
2. Actualizar políticas internas para estar preparado ante futuras solicitudes.
3. Incorporar como se regulara este derecho en tu Reglamento Interno de Trabajo y contrato laboral. 
`
            }
          },
          {
            text: "¿En tu empresa, existen diferencias en el valor del salario para hombres y mujeres aunque ocupen el mismo cargo?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Debes tomar medidas inmediatas para cumplir con la nueva regulación:
2. Realiza un diagnóstico de equidad salarial para identificar y justificar cualquier diferencia con base en criterios objetivos.
3. Alinea los perfiles de cargo y documenta las razones técnicas detrás de cada diferenciación salarial.
4. Diseña e implementa una política de equidad salarial que corrija y prevenga nuevas brechas salariales.

`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          },
          {
            text: "¿Tu empresa tiene implementado un Comité de Convivencia Laboral y protocolos para prevenir, atender y sancionar el acoso laboral?",
            type: "yes_no",
            recommendations: {
              "Sí": `
Debes ajustar tus políticas actuales para cumplir con los nuevos lineamientos de la Ley 2466 de 2025, que amplían el alcance del acoso laboral y sexual. Ahora debes incluir el tramite a seguir en caso de que los comportamientos provengan  de clientes, proveedores, terceros, y en espacios digitales o fuera del lugar de trabajo.
Además, debes integrar una perspectiva de género, con acciones específicas frente al acoso por razón de género y violencia sexual.
Por último, asegúrate que los miembros de Comité de Convivencia Laboral estén capacitados frente al nuevo enfoque del acoso laboral y que tengan  un proceso claro para recibir, hacer seguimiento y atender las quejas.
`,
              "No": `
Debes actuar de inmediato. No contar con Comité y protocolos te expone a sanciones y responsabilidades legales.
1. Conforma el Comité de Convivencia Laboral de acuerdo con la normativa.
2. Diseña una política de acoso laboral y una política de acoso sexual que cumpla con los nuevos lineamientos de la Ley 2466 de 2025, que amplía el alcance del acoso laboral y sexual. Ahora debes incluir el tramite a seguir en caso de que los comportamientos provengan de clientes, proveedores, terceros, y en espacios digitales o fuera del lugar de trabajo.
3. Asegúrate que los miembros de Comité de Convivencia Laboral estén capacitados frente al nuevo enfoque del acoso laboral y que tengan  un proceso claro para recibir, hacer seguimiento y atender las quejas.`
            }
          }
        ]
      },
      // SECCIÓN 6: TERCERIZACIÓN LABORAL
      {
        title: "Tercerización Laboral",
        questions: [
          {
            text: "¿Tu empresa contrata personal a través de Empresas de Servicios Temporales (EST)?",
            type: "yes_no",
            recommendations: {
              "Sí": `
Debes revisar y ajustar tu estrategia de contratación indirecta, ya que la reforma laboral limita el uso de EST únicamente a las siguientes causales:
•	Reemplazo de personal ausente temporalmente.
•	Aumento ocasional de la producción.
•	Labores transitorias que no excedan seis meses.
Recomendaciones clave:
1. Identifica claramente qué cargos o funciones son realmente temporales, como picos de producción, reemplazos por licencias u otras ausencias justificadas.
2. Documenta la causa específica del encargo temporal tanto en el contrato comercial con la EST como en los contratos laborales de los trabajadores en misión.
3. Verifica que los trabajadores en misión no estén desempeñando funciones estructurales o permanentes dentro de tu operación.
4. Implementa controles internos para evitar exceder los límites legales de duración o causalidad.
5. Evita la rotación de personal entre diferentes EST para las mismas funciones, ya que esto puede ser considerado intermediación laboral ilegal.
6. Capacita a líderes y personal de RRHH sobre los riesgos legales y sanciones.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          }
        ]
      },
      // SECCIÓN 7: NUEVAS FORMAS DE PRESTACIÓN DEL SERVICIO
      {
        title: "Nuevas Formas de Prestación del Servicio",
        questions: [
          {
            text: "¿Tienes trabajadores en modalidad de teletrabajo o estás considerando implementarlo?",
            type: "yes_no",
            recommendations: {
              "Sí": `
1. Formaliza el teletrabajo mediante contrato escrito: Incluye condiciones específicas como la modalidad, lugar de ejecución, disponibilidad, medios tecnológicos, y controles sobre el cumplimiento.
2. Incluye cláusula de reversibilidad: El contrato debe establecer que el teletrabajo no es obligatorio para el trabajador, y que puede regresar a la modalidad presencial bajo ciertas condiciones acordadas.
3. Diseña o actualiza la política de teletrabajo: Debe contemplar la seguridad digital, manejo de la información, disponibilidad del trabajador, desconexión laboral, y cumplimiento del SG-SST.
4. Paga el auxilio de conectividad digital:
•	Es obligatorio si el salario del teletrabajador es igual o inferior a 2 SMMLV.
•	Este auxilio reemplaza el auxilio de transporte en la modalidad remota o de teletrabajo.
5. Evalúa el teletrabajo transnacional:
•	Puedes implementarlo si las funciones se pueden desempeñar desde el exterior.
6. Asegura la protección de la salud en el entorno remoto: Incluye al teletrabajador en la evaluación de riesgos del SG-SST y entrega recomendaciones sobre ergonomía, pausas activas y riesgos psicosociales.
7. Implementa canales de reporte y control claros: Utiliza medios tecnológicos para documentar la jornada laboral, cumplimiento de funciones, y entrega de resultados.
`,
              "No": `En tu caso no se requieren ajustes adicionales derivados de la nueva norma.`
            }
          }
        ]
      },
      // SECCIÓN DE CIERRE: PREGUNTAS FINALES
      {
        title: "Preguntas Finales",
        isClosingSection: true, // Flag para identificar esta sección como de cierre
        questions: [
          {
            text: "¿Quieres recibir un reporte mas detallado de los ajustes que debes revisar para implementar la Reforma Laboral 2025 en tu empresa (Ley 2466 de 2025)?",
            type: "yes_no",
            recommendations: {
              "Sí": "¡Excelente! Nos pondremos en contacto contigo para enviarte el reporte detallado.",
              "No": "Entendido. Si cambias de opinión, puedes volver a iniciar el autodiagnóstico en cualquier momento."
            }
          },
          {
            text: "¿Quisieras ser contactado para agendar una consulta especializada con Nicolás Pareja y Asociados?",
            type: "yes_no",
            recommendations: {
              "Sí": "¡Perfecto! Un miembro de nuestro equipo se comunicará contigo a la brevedad para coordinar la consulta.",
              "No": "Comprendido. Respetamos tu decisión. Si en el futuro requieres una consulta, no dudes en contactarnos."
            }
          }
        ]
      }
    ];

    // Función para mostrar la pantalla inicial
    function showInitialScreen() {
      initialScreen.classList.remove('hidden');
      sectionsOverviewScreen.classList.add('hidden');
      questionsScreen.classList.add('hidden');
      interstitialScreen.classList.add('hidden'); // Asegurarse de que la intersticial esté oculta
      contactFormScreen.classList.add('hidden'); // Asegurarse de que el formulario de contacto esté oculto
      completionScreen.classList.add('hidden');
      // Reiniciar el estado de la aplicación
      currentSectionIndex = 0;
      currentQuestionIndex = 0;
      history = [];
      selectedAnswer = null;
      companyClassification = null;
    }

    // Manejador del formulario inicial
    userForm.addEventListener('submit', function (event) {
      event.preventDefault();
      // Aquí podrías guardar los datos del usuario si fuera necesario
      // Por ahora, simplemente avanzamos a la pantalla de resumen de secciones
      initialScreen.classList.add('hidden');
      sectionsOverviewScreen.classList.remove('hidden');
      populateSectionsList();
    });

    // Función para poblar la lista de secciones en la pantalla de resumen
    function populateSectionsList() {
      sectionsList.innerHTML = ''; // Limpiar lista anterior
      sectionsData.forEach((section, index) => {
        // Solo añadir secciones que no sean de cierre a la lista numerada
        if (!section.isClosingSection) {
          const p = document.createElement('p');
          // Formato para el título de la sección: SECCIÓN X: TÍTULO EN MAYÚSCULAS
          p.textContent = `SECCIÓN ${index + 1}: ${section.title.toUpperCase()}`;
          sectionsList.appendChild(p);
        }
      });
    }

    // Manejador del botón "Iniciar mi autodiagnóstico"
    startAutodiagnosisBtn.addEventListener('click', function () {
      sectionsOverviewScreen.classList.add('hidden');
      // Al iniciar, mostrar la pantalla intersticial para la primera sección
      showInterstitialScreen(true); // Pasar 'true' para indicar que es la primera sección
    });

    // Manejador del botón "Volver" desde la pantalla de resumen de secciones
    backToInitialBtn.addEventListener('click', function () {
      showInitialScreen();
    });

    // Función para cargar la pregunta actual
    function loadQuestion() {
      console.log(`[loadQuestion] Loading question. Section: ${currentSectionIndex}, Question: ${currentQuestionIndex}`);
      const section = sectionsData[currentSectionIndex];
      const question = section.questions[currentQuestionIndex];

      // Actualizar el título de la sección actual en formato solicitado
      if (section.isClosingSection) {
        currentSectionTitleElement.textContent = "Preguntas Finales"; // Título específico para la sección de cierre
      } else {
        currentSectionTitleElement.textContent = `SECCIÓN ${currentSectionIndex + 1}: ${section.title.toUpperCase()}`;
      }


      // Lógica para determinar si la pregunta "¿Tienes menos de 10 trabajadores?" debe mostrarse
      if (currentSectionIndex === 2 && currentQuestionIndex === 2 && question.type === "yes_no_conditional") {
        const sectorQuestion = sectionsData[2].questions[0];
        const incomeQuestion = sectionsData[2].questions[1];
        const sectorAnswer = history.find(item => item.questionText === sectorQuestion.text)?.answer;
        const incomeAnswer = history.find(item => item.questionText === incomeQuestion.text)?.answer;

        let tempCompanyClassification = "";
        if (incomeAnswer) {
          const incomeOption = incomeThresholds[sectorAnswer].find(opt => opt.value === incomeAnswer);
          if (incomeOption) {
            tempCompanyClassification = incomeOption.classification;
          }
        }

        // Esta pregunta SOLO se salta si la empresa es Mediana o Gran.
        // Se muestra para Microempresa y Pequeña, independientemente del sector.
        if (!(tempCompanyClassification === "Microempresa" || tempCompanyClassification === "Pequeña")) {
          console.log("[loadQuestion] Skipping conditional question for Mediana/Gran company.");
          currentQuestionIndex++; // Salta esta pregunta
          loadQuestion(); // Carga la siguiente pregunta
          return; // Sale de la función para evitar que se cargue la pregunta actual
        }
      }

      questionTextElement.textContent = question.text;
      optionsContainer.innerHTML = ''; // Limpiar opciones anteriores
      recommendationDiv.classList.add('hidden'); // Ocultar recomendación

      if (question.type === "yes_no" || question.type === "yes_no_conditional") {
        createOptionButton("Sí", "Sí");
        createOptionButton("No", "No");
      } else if (question.type === "multiple_choice") {
        question.options.forEach(option => {
          createOptionButton(option.text, option.value);
        });
      } else if (question.type === "conditional_income") {
        const sectorQuestion = sectionsData[2].questions[0];
        const sectorAnswer = history.find(item => item.questionText === sectorQuestion.text)?.answer;

        if (sectorAnswer && incomeThresholds[sectorAnswer]) {
          incomeThresholds[sectorAnswer].forEach(option => {
            createOptionButton(option.text, option.value);
          });
        } else {
          optionsContainer.innerHTML = '<p>Por favor, selecciona primero el sector de tu empresa para ver las opciones de ingresos.</p>';
          nextBtn.disabled = true; // Deshabilitar botón Siguiente si el sector no está seleccionado
        }
      }

      // Restaurar selección si existe en el historial
      const lastAnswerInHistory = history.find(item => item.questionText === question.text);
      if (lastAnswerInHistory) {
        selectedAnswer = lastAnswerInHistory.answer;
        // Para todos los tipos de preguntas, si hay una respuesta en el historial, márcala
        const selectedBtn = optionsContainer.querySelector(`.option-btn[data-value="${selectedAnswer}"]`);
        if (selectedBtn) {
          selectedBtn.classList.add('selected');
        }
        showRecommendation(question, selectedAnswer);
      } else {
        selectedAnswer = null; // Reiniciar respuesta seleccionada para nuevas preguntas
      }

      updateNavigationButtons(); // Call this function to update button states
      updateProgressBar(); // Asegurarse de que la barra de progreso se actualice al cargar la pregunta
      console.log("[loadQuestion] Question loaded successfully.");
    }

    // Función auxiliar para crear botones de opción
    function createOptionButton(text, value) {
      const button = document.createElement('button');
      button.className = 'option-btn';
      button.textContent = text;
      button.dataset.value = value;
      button.onclick = () => selectOption(value, button);
      optionsContainer.appendChild(button);
    }

    // Función para seleccionar una opción
    function selectOption(value, button) {
      // Desmarcar todas las opciones
      document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
      // Marcar la opción seleccionada
      button.classList.add('selected');
      selectedAnswer = value;
      showRecommendation(sectionsData[currentSectionIndex].questions[currentQuestionIndex], selectedAnswer);
      updateNavigationButtons(); // Update button states after selecting an option
    }

    // **NUEVA FUNCIÓN AUXILIAR: Formatea el texto de la recomendación con párrafos y viñetas**
    function formatRecommendationText(text) {
      let formattedHtml = '';
      // Reemplazar saltos de línea seguidos por un número y punto (ej: "1. Texto") con un marcador temporal para luego convertir a lista
      // Esto es para manejar los numerales que el usuario ha añadido
      let processedText = text.replace(/(\d+\.\s*)/g, '\n• ');
      const lines = processedText.split('\n').map(line => line.trim()).filter(line => line !== ''); // Dividir por saltos de línea, limpiar espacios y remover líneas vacías
      let inList = false;

      lines.forEach(line => {
        // Si la línea comienza con un bullet (•)
        if (line.startsWith('•')) {
          if (!inList) {
            formattedHtml += '<ul>'; // Iniciar nueva lista si no estamos ya en una
            inList = true;
          }
          formattedHtml += `<li>${line.substring(1).trim()}</li>`; // Quitar el bullet y añadir como item de lista
        } else {
          if (inList) {
            formattedHtml += '</ul>'; // Cerrar lista si estábamos en una
            inList = false;
          }
          formattedHtml += `<p>${line}</p>`; // Es un párrafo
        }
      });

      if (inList) { // Asegurarse de cerrar cualquier lista abierta al final
        formattedHtml += '</ul>';
      }
      return formattedHtml;
    }


    // Función para mostrar la recomendación
    function showRecommendation(question, answer) {
      let recommendation = '';

      // Special handling for the first question of Section 3 (Sector question)
      if (currentSectionIndex === 2 && currentQuestionIndex === 0) {
        // No recommendation is displayed for the sector selection itself.
        // The classification and recommendation depend on the *next* question (income).
        recommendationDiv.classList.add('hidden');
        recommendationTextElement.innerHTML = '';
        return; // Exit the function as no recommendation is needed here
      }

      if (question.type === "conditional_income") {
        // For the income question, we need the sector answer from history (which was the previous question)
        const sectorQuestion = sectionsData[2].questions[0];
        const sectorAnswer = history.find(item => item.questionText === sectorQuestion.text)?.answer;

        let currentCompanyClassification = "";
        if (sectorAnswer && incomeThresholds[sectorAnswer]) {
          const selectedIncomeOption = incomeThresholds[sectorAnswer].find(opt => opt.value === answer);
          if (selectedIncomeOption) {
            currentCompanyClassification = selectedIncomeOption.classification;
          }
        }
        companyClassification = currentCompanyClassification; // Update global classification

        // Logic for recommendation based on classification
        if (companyClassification === "Mediana" || companyClassification === "Gran") {
          recommendation = question.recommendations["Mediana"];
        } else { // Microempresa or Pequeña
          recommendation = question.recommendations["continue_to_next"];
        }
      } else if (question.type === "yes_no_conditional") {
        // This question is "¿Tienes menos de 10 trabajadores?"
        // companyClassification should already be updated by the previous income question
        if (companyClassification === "Microempresa" || companyClassification === "Pequeña") {
          if (answer === "Sí") {
            recommendation = question.recommendations["Sí"];
          } else {
            recommendation = question.recommendations["No"];
          }
        } else {
          // This case should ideally not be reached if loadQuestion skip logic is correct
          recommendation = "Esta pregunta no aplica para tu tipo de empresa.";
        }
      } else {
        // For all other regular questions (yes_no, other multiple_choice)
        recommendation = question.recommendations[answer];
      }

      if (recommendation) {
        recommendationDiv.classList.remove('hidden');
        recommendationTextElement.innerHTML = formatRecommendationText(recommendation);
      } else {
        recommendationDiv.classList.add('hidden');
      }
    }

    // Función para avanzar a la siguiente pregunta o sección
    function nextQuestion() {
      console.log(`[nextQuestion] Attempting to advance. Current Section: ${currentSectionIndex}, Current Question: ${currentQuestionIndex}`);
      const currentQuestion = sectionsData[currentSectionIndex].questions[currentQuestionIndex];

      if (selectedAnswer === null) {
        console.log("[nextQuestion] No answer selected. Displaying warning.");
        recommendationDiv.classList.remove('hidden');
        recommendationTextElement.innerHTML = formatRecommendationText("Por favor, selecciona una opción para continuar."); // Usar formatRecommendationText aquí también
        return;
      } else {
        console.log(`[nextQuestion] Answer selected: ${selectedAnswer}. Pushing to history.`);
        history.push({ questionText: currentQuestion.text, answer: selectedAnswer });
      }

      // Lógica para saltar preguntas condicionales en la Sección 3
      if (currentSectionIndex === 2) { // Sección 3: Procesos Disciplinarios y RIT
        if (currentQuestionIndex === 0) { // Pregunta de Sector
          console.log("[nextQuestion] Section 3, Question 0 (Sector). Advancing to Question 1.");
          currentQuestionIndex++; // Avanzar a la pregunta de ingresos
        } else if (currentQuestionIndex === 1) { // Pregunta de Ingresos
          console.log("[nextQuestion] Section 3, Question 1 (Income). Checking conditional skip.");
          const sector = history.find(item => item.questionText === sectionsData[2].questions[0].text)?.answer;
          const incomeAnswer = history.find(item => item.questionText === sectionsData[2].questions[1].text)?.answer;

          let tempCompanyClassification = "";
          if (incomeAnswer) {
            const incomeOption = incomeThresholds[sector]?.find(opt => opt.value === incomeAnswer);
            if (incomeOption) {
              tempCompanyClassification = incomeOption.classification;
            }
          }
          companyClassification = tempCompanyClassification; // Actualizar clasificación global

          // Si es Mediana o Gran, salta la pregunta "¿Tienes menos de 10 trabajadores?" (índice 2)
          if (companyClassification === "Mediana" || companyClassification === "Gran") {
            console.log("[nextQuestion] Company is Mediana/Gran. Skipping Question 2 (conditional).");
            currentQuestionIndex += 2; // Salta la pregunta condicional y va directamente a la siguiente
          } else { // Si es Microempresa o Pequeña (independientemente del sector), avanza a la pregunta "¿Tienes menos de 10 trabajadores?"
            console.log("[nextQuestion] Company is Micro/Pequeña. Advancing to Question 2 (conditional).");
            currentQuestionIndex++;
          }
        } else {
          console.log("[nextQuestion] Section 3, other question. Advancing normally.");
          currentQuestionIndex++; // Para las demás preguntas de la sección 3
        }
      } else {
        console.log("[nextQuestion] Not Section 3. Advancing normally.");
        currentQuestionIndex++; // Para secciones que no son la 3
      }


      if (currentQuestionIndex < sectionsData[currentSectionIndex].questions.length) {
        console.log("[nextQuestion] More questions in current section. Loading next question.");
        loadQuestion();
      } else {
        // Se terminó la sección actual, intentar pasar a la siguiente
        if (currentSectionIndex < sectionsData.length - 1) { // Si hay más secciones
          console.log("[nextQuestion] Section completed. Moving to next section interstitial.");
          currentSectionIndex++;
          currentQuestionIndex = 0; // Reiniciar el índice de preguntas para la nueva sección
          showInterstitialScreen(false); // Mostrar pantalla intersticial para la siguiente sección
        } else { // Todas las secciones completadas
          console.log("[nextQuestion] All sections completed.");
          // Lógica específica para las preguntas finales de contacto
          const finalSection = sectionsData[sectionsData.length - 1];
          const contactQuestion = finalSection.questions[1]; // La segunda pregunta de la sección final
          const contactAnswer = history.find(item => item.questionText === contactQuestion.text)?.answer;

          if (contactAnswer === "Sí") {
            console.log("[nextQuestion] User wants to be contacted. Showing contact form.");
            questionsScreen.classList.add('hidden');
            contactFormScreen.classList.remove('hidden');
          } else {
            console.log("[nextQuestion] User does not want to be contacted. Showing completion screen directly.");
            questionsScreen.classList.add('hidden');
            completionScreen.classList.remove('hidden');
          }
          console.log("Autodiagnóstico completado. Historial:", history);
        }
      }
      console.log(`[nextQuestion] End of nextQuestion. New Section: ${currentSectionIndex}, New Question: ${currentQuestionIndex}`);
    }

    // Manejador del botón de continuar en la pantalla intersticial
    continueToNextSectionBtn.addEventListener('click', function () {
      console.log("[continueToNextSectionBtn] Continuing to next section.");
      interstitialScreen.classList.add('hidden');
      questionsScreen.classList.remove('hidden');
      loadQuestion();
    });

    // Función para mostrar la pantalla intersticial
    function showInterstitialScreen(isFirstSection = false) {
      console.log(`[showInterstitialScreen] Displaying interstitial. Is first section: ${isFirstSection}`);
      questionsScreen.classList.add('hidden');
      interstitialScreen.classList.remove('hidden');
      const nextSection = sectionsData[currentSectionIndex];

      if (isFirstSection) {
        interstitialMainTitle.textContent = "¡Comencemos tu autodiagnóstico!";
        interstitialDescription.textContent = "Estás a punto de iniciar la primera sección de preguntas. Esto te ayudará a entender cómo la Reforma Laboral 2025 afecta a tu empresa.";
        nextSectionTitleElement.textContent = `SECCIÓN ${currentSectionIndex + 1}: ${nextSection.title.toUpperCase()}`;
      } else {
        interstitialMainTitle.textContent = "¡Preparado para la siguiente sección!";
        interstitialDescription.textContent = "Estás a punto de comenzar:";
        nextSectionTitleElement.textContent = `SECCIÓN ${currentSectionIndex + 1}: ${nextSection.title.toUpperCase()}`;
      }
      console.log(`[showInterstitialScreen] Interstitial for section: ${nextSection.title}`);
    }


    // Función para volver a la pregunta o sección anterior
    function previousQuestion() {
      console.log(`[previousQuestion] Attempting to go back. Current Section: ${currentSectionIndex}, Current Question: ${currentQuestionIndex}`);

      if (contactFormScreen.classList.contains('hidden') === false) {
        // Si estamos en la pantalla del formulario de contacto, volvemos a la última pregunta de la sección final
        console.log("[previousQuestion] Currently on contact form. Going back to final questions.");
        contactFormScreen.classList.add('hidden');
        questionsScreen.classList.remove('hidden');
        currentSectionIndex = sectionsData.length - 1; // Última sección
        currentQuestionIndex = sectionsData[currentSectionIndex].questions.length - 1; // Última pregunta de la última sección
        loadQuestion();
        return; // Salir de la función
      }


      if (currentQuestionIndex > 0) {
        // Eliminar la última respuesta del historial al retroceder
        history.pop();
        console.log("[previousQuestion] Popped last answer from history.");

        // Lógica inversa para preguntas condicionales en la Sección 3
        if (currentSectionIndex === 2) {
          // Si estamos en la pregunta del RIT (índice 3)
          // y la pregunta anterior (índice 2, "Tienes menos de 10 trabajadores?") fue saltada
          if (currentQuestionIndex === 3 && sectionsData[currentSectionIndex].questions[currentQuestionIndex - 1]?.type === "yes_no_conditional") {
            console.log("[previousQuestion] Section 3, Question 3. Checking for conditional skip backtrack.");
            // Se necesita recalcular la clasificación de la empresa a partir del historial
            const sector = history.find(item => item.questionText === sectionsData[2].questions[0].text)?.answer;
            const incomeAnswer = history.find(item => item.questionText === sectionsData[2].questions[1].text)?.answer;

            let tempCompanyClassification = "";
            if (incomeAnswer) {
              const incomeOption = incomeThresholds[sector]?.find(opt => opt.value === incomeAnswer);
              if (incomeOption) {
                tempCompanyClassification = incomeOption.classification;
              }
            }

            // Si la pregunta de "menos de 10 trabajadores" fue saltada (es decir, era Mediana o Gran), retrocede dos pasos
            if (tempCompanyClassification === "Mediana" || tempCompanyClassification === "Gran") {
              console.log("[previousQuestion] Company was Mediana/Gran, skipping back 2 questions.");
              currentQuestionIndex -= 2;
            } else { // Si la pregunta de "menos de 10 trabajadores" SÍ se mostró (Micro/Pequeña), retrocede un paso
              console.log("[previousQuestion] Company was Micro/Pequeña, skipping back 1 question.");
              currentQuestionIndex--;
            }
          } else {
            console.log("[previousQuestion] Normal backtrack in section.");
            currentQuestionIndex--;
          }
        } else {
          console.log("[previousQuestion] Normal backtrack in section.");
          currentQuestionIndex--;
        }
        loadQuestion();
      } else {
        // Si estamos en la primera pregunta de una sección, volvemos a la pantalla intersticial de la sección anterior
        if (currentSectionIndex > 0) {
          console.log("[previousQuestion] First question of section. Going back to previous interstitial.");
          currentSectionIndex--;
          currentQuestionIndex = 0; // Al volver a la pantalla intersticial, la próxima pregunta será la primera de esa sección
          showInterstitialScreen(false); // No es la primera sección global, pero sí la primera de la sección a la que volvemos
        } else {
          // Si estamos en la primera pregunta de la primera sección, volvemos a la pantalla de resumen de secciones
          console.log("[previousQuestion] First question of first section. Going back to sections overview.");
          questionsScreen.classList.add('hidden');
          sectionsOverviewScreen.classList.remove('hidden');
        }
      }
      console.log(`[previousQuestion] End of previousQuestion. New Section: ${currentSectionIndex}, New Question: ${currentQuestionIndex}`);
    }

    // Función para actualizar el estado de los botones de navegación (Volver y Siguiente)
    function updateNavigationButtons() {
      console.log("[updateNavigationButtons] Updating navigation buttons state.");
      // Habilitar/deshabilitar el botón "Volver"
      if (currentSectionIndex === 0 && currentQuestionIndex === 0) {
        backBtn.disabled = true; // Deshabilitar si es la primera pregunta de la primera sección
      } else {
        backBtn.disabled = false; // Habilitar en cualquier otro caso
      }

      // Habilitar/deshabilitar el botón "Siguiente"
      // El botón "Siguiente" debe estar deshabilitado si no se ha seleccionado una respuesta,
      // a menos que la pregunta actual sea de tipo "conditional_income" y la recomendación
      // sea "continue_to_next" (lo que significa que no se espera una selección para avanzar).
      const currentQuestion = sectionsData[currentSectionIndex].questions[currentQuestionIndex];
      if (selectedAnswer === null && !(currentQuestion.type === "conditional_income" && recommendationTextElement.innerHTML.includes("continúa a la siguiente pregunta"))) {
        nextBtn.disabled = true;
        console.log("[updateNavigationButtons] Next button disabled (no answer selected or not conditional income with continue).");
      } else {
        nextBtn.disabled = false;
        console.log("[updateNavigationButtons] Next button enabled.");
      }
    }


    // Función para actualizar la barra de progreso
    function updateProgressBar() {
      const totalQuestionsInCurrentSection = sectionsData[currentSectionIndex].questions.length;
      let effectiveTotalQuestions = totalQuestionsInCurrentSection;
      // Number of questions to consider for progress calculation, including the current one.
      let questionsConsideredForProgress = currentQuestionIndex + 1;

      // Special handling for Section 3 conditional question
      if (currentSectionIndex === 2) {
        const sectorQuestion = sectionsData[2].questions[0];
        const incomeQuestion = sectionsData[2].questions[1];
        // Retrieve answers from history, as they would have been recorded by now
        const sectorAnswer = history.find(item => item.questionText === sectorQuestion.text)?.answer;
        const incomeAnswer = history.find(item => item.questionText === incomeQuestion.text)?.answer;

        if (sectorAnswer && incomeAnswer) {
          let tempCompanyClassification = "";
          const incomeOption = incomeThresholds[sectorAnswer]?.find(opt => opt.value === incomeAnswer);
          if (incomeOption) {
            tempCompanyClassification = incomeOption.classification;
          }

          // If company is Mediana or Gran, the conditional question (index 2) is skipped.
          if (tempCompanyClassification === "Mediana" || tempCompanyClassification === "Gran") {
            effectiveTotalQuestions = totalQuestionsInCurrentSection - 1; // One question is skipped from total
            // If the current question index is *after* the skipped question's original index (index 2)
            // we need to adjust the numerator because one question was skipped before this point.
            if (currentQuestionIndex >= 2) {
              questionsConsideredForProgress = currentQuestionIndex; // If Q3 was skipped, Q4 is now effectively Q3.
            }
          }
        }
      }

      let progress = 0;
      if (effectiveTotalQuestions > 0) {
        progress = (questionsConsideredForProgress / effectiveTotalQuestions) * 100;
      }

      // Ensure progress is not negative or greater than 100
      progress = Math.max(0, Math.min(100, progress));

      if (progressBarFill) { // Defensive check to ensure element exists
        progressBarFill.style.width = `${progress}%`;
        // Log for debugging
        console.log(`[ProgressBar] Sección: ${currentSectionIndex + 1}, Índice Pregunta Actual: ${currentQuestionIndex}, Preguntas Consideradas: ${questionsConsideredForProgress}, Total Efectivo: ${effectiveTotalQuestions}, Progreso Calculado: ${progress.toFixed(2)}%, Ancho Aplicado: ${progressBarFill.style.width}`);
      } else {
        console.error("[ProgressBar] Elemento 'progressBarFill' no encontrado.");
      }
    }

    // Manejador del formulario de contacto
    contactForm.addEventListener('submit', function (event) {
      event.preventDefault();
      // Aquí podrías enviar los datos del formulario de contacto
      console.log("Datos de contacto enviados:", {
        empresa: document.getElementById('empresa').value,
        telefono_contacto: document.getElementById('telefono_contacto').value,
        email_contacto: document.getElementById('email_contacto').value
      });
      // Después de enviar, mostrar la pantalla de completado
      contactFormScreen.classList.add('hidden');
      completionScreen.classList.remove('hidden');
    });


    // Inicializar la pantalla al cargar
    showInitialScreen();
  </script>
</body>

</html>